function setupFullscreen(){function e(){$("body").removeClass("has-fullscreen")}var a=$("<div>").addClass("fullscreen-overlay loader-parent").click(function(){e()}).appendTo("body");$(".page:not(.no-fullscreen) .media").click(function(){if(a.removeClass("loaded loading"),!($(this).parents(".panning").length>0)){var e=$(this).find("img, video").first().clone(),n=$(this).find(".loading-spinner").clone();if(a.empty().append(e).append(n),e.is("video")){setTimeout(function(){a.addClass("loading")},10),e.on("canplay",function(){e.addClass("loaded"),a.addClass("loaded").removeClass("loading"),e.get(0).play()});var i=e.get(0);i.load()}setTimeout(function(){$("body").addClass("has-fullscreen")},10)}}),$(document).on("keydown",function(a){27==a.keyCode&&e()})}function setupVideoMedia(){function e(){playVideoMedia($(i),!0)}function a(){var e=$(window).width(),a=$(window).height();t.each(function(){var n=$(this).get(0).getBoundingClientRect();n.bottom<0||n.right<0||n.left>e||n.top>a||($(this).addClass("was-visible"),t=$("section.project:not(.was-visible)"),loadPage($(this).find(".page").first()))})}var n,i=null;$(document).on("mouseenter",".page.video .media",function(){n&&(clearTimeout(n),n=0),i=this,n=setTimeout(e,100)}).on("mouseleave",".page.video .media",function(){n&&(clearTimeout(n),n=0),playVideoMedia($(this),!1)}).on("click",".page.video .media",function(){$(this).find("video").get(0).currentTime=0});var t=$("section.project:not(.was-visible)");a(),$(window).on("scroll resize",a)}function setupMediaSizing(){$(".media video").on("resize",function(){sizeMedia($(this).parents(".media"))}),$(".media img").on("load",function(){sizeMedia($(this).parents(".media"))})}function sizeMedia(e){var a=e.children().eq(0);if(a.length&&!e.parent(".page").hasClass("no-scale")){var n=e.width(),i=e.height(),t=a.get(0).offsetWidth,o=a.get(0).offsetHeight,s=1;s=t/o>n/i?n/t:i/o,s=Math.min(s,1),a.css("transform","scale("+s+")")}}function buildPagers(){function e(){a=window.screen.width<480?16:32,n=16,i=$(".pages").width(),t=i-2*(a+n),$(".page").css({width:t,minWidth:t,marginRight:n}),$(".page:first-child").css({marginLeft:n+a}),$(".page:last-child").css({marginRight:a}),$(".media").each(function(){sizeMedia($(this))})}var a,n,i,t;e(),$(window).resize(e),$(".pages").each(function(){var e,i=$(this),o=$(this).find(".page-scroll"),s=$(this).find(".page"),d=0,l=-1,c=!1,r={};i.on("dragstart",function(e){e.preventDefault()}).on("click",function(e){c&&(e.preventDefault(),e.stopPropagation())}).on("wheel",function(e){Math.abs(e.originalEvent.deltaX)&&e.preventDefault()});var p=s.length;if(!(1>=p)){i.addClass("pannable");var u=function(e){0>e||e>=p||e in r||(r[e]=!0,loadPage(s.eq(e)))},f=function(a,i,s){void 0===s&&(s=!0),void 0===i&&(i=!1),d=Math.max(0,Math.min((t+n)*(p-1),a)),o.toggleClass("animate-scroll",i).css("transform","translate3d("+-d+"px,0,0)");var c=Math.round(d/t);l!=c&&(l=c,s&&(u(l-1),u(l),u(l+1)),e.find(".page-dot").each(function(e){$(this).toggleClass("active",e==l)}))},g=function(e){f(e*(t+n),!0)};$("<div>").addClass("edge-clicker prev").css("width",a).appendTo(i).click(function(){g(l-1)}),$("<div>").addClass("edge-clicker next").css("width",a).appendTo(i).click(function(){g(l+1)}),e=$("<div>").addClass("page-dots").appendTo(i);for(var h=function(){g($(this).index())},v=0;p>v;v++)e.append($("<div>").addClass("page-dot").click(h));var m=0,C=-1,w=!1,b=new Hammer(i.get(0),{dragLockToAxis:!0});b.on("panend pan swipe",function(e){e.preventDefault(),e.srcEvent.preventDefault();var a=e.deltaX<0;switch(e.type){case"pan":if(!w){var n=e.deltaX-m;c=!0,0>C&&(C=l),i.addClass("panning"),f(d-n),m=e.deltaX}break;case"swipe":w=!0,m=0,a=0==(e.direction&Hammer.DIRECTION_RIGHT),g(C+(a?1:-1)),setTimeout(function(){c=!1,C=-1,i.removeClass("panning")},0),e.srcEvent.stopPropagation();break;case"panend":w||(m=0,g(l),setTimeout(function(){c=!1,C=-1,i.removeClass("panning")},0)),w=!1}});var y,M=!0;i.on("wheel",function(e){var a=e.originalEvent.deltaX;M&&Math.abs(a)>Math.abs(e.originalEvent.deltaY)&&Math.abs(a)>30&&Math.abs(a)>Math.abs(y)&&(g(l+(a>0?1:-1)),M=!1,setTimeout(function(){M=!0},100)),y=a}),f(0,!1,!1)}})}function loadPage(e){}function playVideoMedia(e,a){e.data("should-be-playing",a);var n=e.find("video");a?e.hasClass("loaded")?n.get(0).play():(e.addClass("loading"),n.off("canplay").on("canplay",function(){e.addClass("loaded").removeClass("loading"),e.data("should-be-playing")&&n.get(0).play()}),n.get(0).load()):n.get(0).pause()}$(document).ready(function(){buildPagers(),setupMediaSizing(),setupVideoMedia(),setupFullscreen(),FastClick.attach(document.body),$(".project a").attr("target","_blank")});