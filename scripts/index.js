function setupFullscreen(){function e(){n.removeClass("visible")}var n=$("<div>").addClass("fullscreen-overlay loader-parent").click(function(){e()}).appendTo("body");$(".page:not(.no-fullscreen) .media").click(function(){if(n.removeClass("loaded"),!($(this).parents(".panning").length>0)){var e=$(this).find("img, video").eq(0).clone(),a=$(this).find(".loading-spinner").clone();if(n.empty().append(e).append(a),e.is("video")){e.removeClass("loaded").on("playing",function(){$(this).addClass("loaded"),$(this).parents(".loader-parent").addClass("loaded")});var i=e.get(0);i.play()}setTimeout(function(){n.addClass("visible")},10)}}),$(document).on("keydown",function(n){27==n.keyCode&&e()})}function setupVideoMedia(){function e(){var e=$(window).width(),a=$(window).height();n.each(function(){var i=$(this).get(0).getBoundingClientRect();i.bottom<0||i.right<0||i.left>e||i.top>a||($(this).addClass("was-visible"),n=$("section.project:not(.was-visible)"),loadPage($(this).find(".page").eq(0)))})}$(document).on("mouseenter",".page.video .media",function(){$(this).find("video").get(0).play()}).on("mouseleave",".page.video .media",function(){$(this).find("video").get(0).pause()}).on("click",".page.video .media",function(){$(this).find("video").get(0).currentTime=0});var n=$("section.project:not(.was-visible)");e(),$(window).on("scroll resize",e)}function setupMediaSizing(){$(".media video").on("resize",function(){sizeMedia($(this).parents(".media"))}),$(".media img").on("load",function(){sizeMedia($(this).parents(".media"))})}function sizeMedia(e){var n=e.children().eq(0);if(n.length&&!e.parent(".page").hasClass("no-scale")){var a=e.width(),i=e.height(),t=n.get(0).offsetWidth,s=n.get(0).offsetHeight,o=1;o=t/s>a/i?a/t:i/s,o=Math.min(o,1),n.css("transform","scale("+o+")")}}function buildPagers(){function e(){n=window.screen.width<480?16:32,a=16,i=$(".pages").width(),t=i-2*(n+a),$(".page").css({width:t,minWidth:t,marginRight:a}),$(".page:first-child").css({marginLeft:a+n}),$(".page:last-child").css({marginRight:n}),$(".media").each(function(){sizeMedia($(this))})}var n,a,i,t;e(),$(window).resize(e),$(".pages").each(function(){var e,i=$(this),s=$(this).find(".page-scroll"),o=$(this).find(".page"),d=0,l=-1,c=!1,r={};i.on("dragstart",function(e){e.preventDefault()}).on("click",function(e){c&&(e.preventDefault(),e.stopPropagation())}).on("wheel",function(e){Math.abs(e.originalEvent.deltaX)&&e.preventDefault()});var p=o.length;if(!(1>=p)){i.addClass("pannable");var f=function(e){0>e||e>=p||e in r||(r[e]=!0,loadPage(o.eq(e)))},g=function(n,i,o){void 0===o&&(o=!0),void 0===i&&(i=!1),d=Math.max(0,Math.min((t+a)*(p-1),n)),s.toggleClass("animate-scroll",i).css("transform","translate3d("+-d+"px,0,0)");var c=Math.round(d/t);l!=c&&(l=c,o&&(f(l-1),f(l),f(l+1)),e.find(".page-dot").each(function(e){$(this).toggleClass("active",e==l)}))},u=function(e){g(e*(t+a),!0)};$("<div>").addClass("edge-clicker prev").css("width",n).appendTo(i).click(function(){u(l-1)}),$("<div>").addClass("edge-clicker next").css("width",n).appendTo(i).click(function(){u(l+1)}),e=$("<div>").addClass("page-dots").appendTo(i);for(var h=function(){u($(this).index())},v=0;p>v;v++)e.append($("<div>").addClass("page-dot").click(h));var m=0,w=-1,C=!1,b=new Hammer(i.get(0),{dragLockToAxis:!0});b.on("panend pan swipe",function(e){e.preventDefault(),e.srcEvent.preventDefault();var n=e.deltaX<0;switch(e.type){case"pan":if(!C){var a=e.deltaX-m;c=!0,0>w&&(w=l),i.addClass("panning"),g(d-a),m=e.deltaX}break;case"swipe":C=!0,m=0,n=0==(e.direction&Hammer.DIRECTION_RIGHT),u(w+(n?1:-1)),setTimeout(function(){c=!1,w=-1,i.removeClass("panning")},0),e.srcEvent.stopPropagation();break;case"panend":C||(m=0,u(l),setTimeout(function(){c=!1,w=-1,i.removeClass("panning")},0)),C=!1}});var M,k=!0;i.on("wheel",function(e){var n=e.originalEvent.deltaX;k&&Math.abs(n)>Math.abs(e.originalEvent.deltaY)&&Math.abs(n)>30&&Math.abs(n)>Math.abs(M)&&(u(l+(n>0?1:-1)),k=!1,setTimeout(function(){k=!0},100)),M=n}),g(0,!1,!1)}})}function loadPage(e){var n=e.find("video:not(.loaded)");n.length?(n.on("canplay",function(){$(this).addClass("loaded"),$(this).parents(".loader-parent").addClass("loaded")}),n.get(0).load()):e.find(".loading-spinner").remove()}$(document).ready(function(){buildPagers(),setupMediaSizing(),setupVideoMedia(),setupFullscreen(),$(".project a").attr("target","_blank")});